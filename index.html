<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Client Info (Iframe)</title>
  <style>
    body {
      font-family: monospace;
      white-space: pre-wrap;
      padding: 1em;
      background: #f9f9f9;
    }
  </style>
</head>
<body>
  <h2>Client Environment Info (Inside Iframe)</h2>
  <div id="report">Collecting...</div>

  <script>
    (async function gatherClientInfo() {
      const report = {};
      const output = document.getElementById('report');

      report['User Agent'] = navigator.userAgent;
      report['Platform'] = navigator.platform;
      report['App Version'] = navigator.appVersion;
      report['Vendor'] = navigator.vendor;
      report['Languages'] = navigator.languages;
      report['Language'] = navigator.language;
      report['Online'] = navigator.onLine;

      report['Screen Width'] = screen.width;
      report['Screen Height'] = screen.height;
      report['Device Pixel Ratio'] = window.devicePixelRatio;
      report['Viewport Width'] = window.innerWidth;
      report['Viewport Height'] = window.innerHeight;
      report['Max Touch Points'] = navigator.maxTouchPoints;

      report['Timezone'] = Intl.DateTimeFormat().resolvedOptions().timeZone;
      report['Locale'] = Intl.NumberFormat().resolvedOptions().locale;

      report['Hardware Concurrency'] = navigator.hardwareConcurrency;
      report['Device Memory (GB)'] = navigator.deviceMemory || 'Not supported';

      if (navigator.storage?.estimate) {
        const { quota, usage } = await navigator.storage.estimate();
        report['Storage Quota (bytes)'] = quota;
        report['Storage Usage (bytes)'] = usage;
      }

      const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      if (conn) {
        report['Network Type'] = conn.effectiveType;
        report['Downlink'] = conn.downlink;
        report['RTT'] = conn.rtt;
      }

      if (navigator.getBattery) {
        try {
          const battery = await navigator.getBattery();
          report['Battery Level (%)'] = battery.level * 100;
          report['Charging'] = battery.charging;
        } catch {}
      }

      if (navigator.mediaDevices?.enumerateDevices) {
        try {
          const devices = await navigator.mediaDevices.enumerateDevices();
          report['Media Devices'] = devices.map(d => `${d.kind}: ${d.label || '(hidden)'}`);
        } catch {}
      }

      try {
        const canvas = document.createElement('canvas');
        const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
        const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
        if (debugInfo) {
          report['GPU Vendor'] = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);
          report['GPU Renderer'] = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
        }
      } catch {}

      report['WebAssembly'] = typeof WebAssembly !== 'undefined';
      report['BigInt'] = typeof BigInt !== 'undefined';
      report['Clipboard API'] = !!navigator.clipboard;
      report['Service Worker'] = 'serviceWorker' in navigator;

      try {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        ctx.textBaseline = 'top';
        ctx.font = '16px Arial';
        ctx.fillText('CanvasFingerprint', 2, 2);
        report['Canvas Fingerprint'] = canvas.toDataURL();
      } catch {}

      if (navigator.permissions) {
        try {
          const geo = await navigator.permissions.query({ name: 'geolocation' });
          report['Geolocation Permission'] = geo.state;
        } catch {}
      }

      report['Pointer Support'] = 'ontouchstart' in window ? 'Touch' : 'Mouse';

      output.textContent = Object.entries(report)
        .map(([k, v]) => `${k}: ${Array.isArray(v) ? v.join('\n  ') : v}`)
        .join('\n\n');
    })();
  </script>
</body>
</html>
